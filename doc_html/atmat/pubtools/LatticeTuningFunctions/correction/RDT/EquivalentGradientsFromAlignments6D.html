<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of EquivalentGradientsFromAlignments6D</title>
  <meta name="keywords" content="EquivalentGradientsFromAlignments6D">
  <meta name="description" content="EQUIVALENTGRADIENTSFROMALIGNMENTS6D Estimated normal quad gradients from sext offsets">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>

<!-- ../../../../menu.html atmat --><!-- ../../../menu.html pubtools --><!-- ../../menu.html LatticeTuningFunctions --><!-- ../menu.html correction --><!-- menu.html RDT --><h1>EquivalentGradientsFromAlignments6D
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>EQUIVALENTGRADIENTSFROMALIGNMENTS6D Estimated normal quad gradients from sext offsets</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="box"><strong>function [kn,ks,ind]=EquivalentGradientsFromAlignments6D(r,inCOD) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../../../../atcollab.png)"><pre class="comment">EQUIVALENTGRADIENTSFROMALIGNMENTS6D Estimated normal quad gradients from sext offsets
[kn,    1) estimated normal quad gradients from sext offsets, quad
           errors in quadrupoles and sextupoles.
 ks,    2) estimated skew quad gradients from sext offsets, quad
           errors in quadrupoles, quadrupole rotation.
 ind    3) indexes of locations at wich kn and ks are found
 ]=EquivalentGradientsFromAlignments6D(
 r,     1) AT lattice structure with errors
 inCOD
 )

 the function finds the closed orbit at sextupoles and converts it to
 equivalent quadrupole and skew quadrupole gradients for the computation
 of skew and normal quadrupole RDT 
 quadrupole rotations are also converted in skew quadrupole gradients.
 
 it returns the complete list of normal (kn) and skew (ks) quadrupole
 gradients at the given indexes (ind) ( not integrated, PolynomB)
 
 
  See also</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../../../../atcollab.png)">
This function calls:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="../../../../../atmat/atphysics/Orbit/findorbit6.html" class="code" title="function [orbit,fixedpoint] = findorbit6(RING,varargin)">findorbit6</a>	FINDORBIT6 finds closed orbit in the full 6-d phase space</li><li><a href="../../../../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>	ATGETCELLS performs a search on MATLAB cell arrays of structures</li><li><a href="../../../../../atmat/lattice/atgetfieldvalues.html" class="code" title="function values = atgetfieldvalues(ring,varargin)">atgetfieldvalues</a>	ATGETFIELDVALUES retrieves the field values AT cell array of elements</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="atQuadRDTdispersioncorrection.html" class="code" title="function [rcor,inCOD,qs]=atQuadRDTdispersioncorrection(rerr,r0,indBPM,indQCor,inCOD,neigSteerer,correctflags,scalefactor,wdisp,ModelRM,steererlimit,printouttext)">atQuadRDTdispersioncorrection</a>	ATQUADRDTDISPERSIONCORRECTION - Make dispersion correction based on RDTs</li><li><a href="atRDTdispersioncorrection.html" class="code" title="function [rcor,inCOD,qs,ss]=atRDTdispersioncorrection(rerr,r0,indBPM,indQCor,indSCor,inCOD,neigSteerer,correctflags,scalefactor,wdisp,ModelRM,steererlimit,printouttext)">atRDTdispersioncorrection</a>	ATRDTDISPERSIONCORRECTION Makes dispersion correction based on RDTs</li><li><a href="atRDTdispersionmeasuredcorrection.html" class="code" title="function [rcor,inCOD,qs,ss]=atRDTdispersionmeasuredcorrection(rerr,rfit,r0,indBPM,indQCor,indSCor,inCOD,neigSteerer,correctflags,scalefactor,wdisp,ModelRM,steererlimit,printouttext)">atRDTdispersionmeasuredcorrection</a>	ATRDTDISPERSIONMEASUREDCORRECTION Makes correction of dispersion based on</li><li><a href="atSkewRDTdispersioncorrection.html" class="code" title="function [rcor,inCOD,ss]=atSkewRDTdispersioncorrection(rerr,r0,indBPM,indSCor,inCOD,neigSteerer,correctflags,scalefactor,wdisp,ModelRM,steererlimit,printouttext)">atSkewRDTdispersioncorrection</a>	function [...</li></ul>
</div>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../../../../atcollab.png)">
<ul style="list-style-image:url(../../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function t1=getT1(a,ind)</a></li><li><a href="#_sub2" class="code">function r1=getR1(a)</a></li></ul>
</div>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../../../../atcollab.png)"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [kn,ks,ind]=EquivalentGradientsFromAlignments6D(r,inCOD)</a>
0002 <span class="comment">%EQUIVALENTGRADIENTSFROMALIGNMENTS6D Estimated normal quad gradients from sext offsets</span>
0003 <span class="comment">%[kn,    1) estimated normal quad gradients from sext offsets, quad</span>
0004 <span class="comment">%           errors in quadrupoles and sextupoles.</span>
0005 <span class="comment">% ks,    2) estimated skew quad gradients from sext offsets, quad</span>
0006 <span class="comment">%           errors in quadrupoles, quadrupole rotation.</span>
0007 <span class="comment">% ind    3) indexes of locations at wich kn and ks are found</span>
0008 <span class="comment">% ]=EquivalentGradientsFromAlignments6D(</span>
0009 <span class="comment">% r,     1) AT lattice structure with errors</span>
0010 <span class="comment">% inCOD</span>
0011 <span class="comment">% )</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% the function finds the closed orbit at sextupoles and converts it to</span>
0014 <span class="comment">% equivalent quadrupole and skew quadrupole gradients for the computation</span>
0015 <span class="comment">% of skew and normal quadrupole RDT</span>
0016 <span class="comment">% quadrupole rotations are also converted in skew quadrupole gradients.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">% it returns the complete list of normal (kn) and skew (ks) quadrupole</span>
0019 <span class="comment">% gradients at the given indexes (ind) ( not integrated, PolynomB)</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%</span>
0022 <span class="comment">%  See also</span>
0023 
0024 <span class="comment">% quadrupole and skew quadrupole errors are introduced via COD in</span>
0025 <span class="comment">% sextupoles</span>
0026 indsext=find(<a href="../../../../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>(r,<span class="string">'Class'</span>,<span class="string">'Sextupole'</span>))';
0027 
0028 b3=<a href="../../../../../atmat/lattice/atgetfieldvalues.html" class="code" title="function values = atgetfieldvalues(ring,varargin)">atgetfieldvalues</a>(r,indsext,<span class="string">'PolynomB'</span>,{1,3});
0029 
0030 oin=<a href="../../../../../atmat/atphysics/Orbit/findorbit6.html" class="code" title="function [orbit,fixedpoint] = findorbit6(RING,varargin)">findorbit6</a>(r,indsext,inCOD);<span class="comment">% orbit at entrance of sextupole DO NOT USE HERE findorbit6Err!</span>
0031 oout=<a href="../../../../../atmat/atphysics/Orbit/findorbit6.html" class="code" title="function [orbit,fixedpoint] = findorbit6(RING,varargin)">findorbit6</a>(r,indsext+1,inCOD); <span class="comment">% orbit at exit of sextupole</span>
0032 
0033 xmisal=cellfun(@(a)<a href="#_sub1" class="code" title="subfunction t1=getT1(a,ind)">getT1</a>(a,1),r(indsext));
0034 ymisal=cellfun(@(a)<a href="#_sub1" class="code" title="subfunction t1=getT1(a,ind)">getT1</a>(a,3),r(indsext));
0035 
0036 Dx=(oout(1,:)+oin(1,:))/2; <span class="comment">% orbit average in sextupole</span>
0037 Dy=(oout(3,:)+oin(3,:))/2; <span class="comment">% orbit average in sextupole</span>
0038 
0039 <span class="comment">% quarupole errors in sextupoles</span>
0040 kn_sext_err=cellfun(@(a)a.PolynomB(2),r(indsext));
0041 ks_sext_err=cellfun(@(a)a.PolynomA(2),r(indsext));
0042 
0043 kn_sext=-2.*b3.*(-Dx+xmisal')'+kn_sext_err;
0044 ks_sext=-2.*b3.*(-Dy+ymisal')'+ks_sext_err;
0045 
0046 <span class="comment">% quadrupole rotations</span>
0047 indquad=find(<a href="../../../../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>(r,<span class="string">'Class'</span>,<span class="string">'Quadrupole'</span>))';
0048 
0049 kn2=<a href="../../../../../atmat/lattice/atgetfieldvalues.html" class="code" title="function values = atgetfieldvalues(ring,varargin)">atgetfieldvalues</a>(r,indquad,<span class="string">'PolynomB'</span>,{1,2});
0050 ks2=<a href="../../../../../atmat/lattice/atgetfieldvalues.html" class="code" title="function values = atgetfieldvalues(ring,varargin)">atgetfieldvalues</a>(r,indquad,<span class="string">'PolynomA'</span>,{1,2});
0051 srot=cellfun(@(a)<a href="#_sub2" class="code" title="subfunction r1=getR1(a)">getR1</a>(a),r(indquad));
0052 
0053 kn_quad=(1-srot).*kn2;
0054 ks_quad=-srot.*kn2+ks2;
0055 
0056 <span class="comment">% all elements with PolynomB, not sextupoles or quadrupoles</span>
0057 indPolB=find(<a href="../../../../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>(r,<span class="string">'PolynomB'</span>) &amp; <span class="keyword">...</span>
0058     ~<a href="../../../../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>(r,<span class="string">'Class'</span>,<span class="string">'Quadrupole'</span>) &amp; <span class="keyword">...</span>
0059     ~<a href="../../../../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>(r,<span class="string">'Class'</span>,<span class="string">'Sextupole'</span> ))';
0060 
0061 NpolB=cellfun(@(a)length(a.PolynomB),r(indPolB));
0062 NpolA=cellfun(@(a)length(a.PolynomA),r(indPolB));
0063 
0064 indPolB=indPolB(NpolB&gt;=2 &amp; NpolA&gt;=2 &amp; ~ismember(indPolB,[indquad indsext])');
0065 
0066 kn_all=cellfun(@(a)a.PolynomB(2),r(indPolB));<span class="comment">%-kn0_all;</span>
0067 ks_all=cellfun(@(a)a.PolynomA(2),r(indPolB));<span class="comment">%-ks0_all;</span>
0068 
0069 [ind,ord]=sort([indsext,indquad,indPolB]);
0070 
0071 kn=[kn_sext;kn_quad;kn_all];
0072 ks=[ks_sext;ks_quad;ks_all];
0073 
0074 <span class="comment">% integrated strengths</span>
0075 <span class="comment">%L=cellfun(@(a)a.Length,r(ind));</span>
0076 
0077 kn=kn(ord);<span class="comment">%.*L;</span>
0078 ks=ks(ord);<span class="comment">%.*L;</span>
0079 
0080 
0081 <span class="keyword">return</span>
0082 
0083 
0084 <a name="_sub1" href="#_subfunctions" class="code">function t1=getT1(a,ind)</a>
0085 t1=0;
0086 <span class="keyword">if</span> isfield(a,<span class="string">'T1'</span>)
0087     t1=-a.T1(ind);
0088 <span class="keyword">end</span>
0089 <span class="keyword">return</span>
0090 
0091 
0092 <a name="_sub2" href="#_subfunctions" class="code">function r1=getR1(a)</a>
0093 r1=0;
0094 <span class="keyword">if</span> isfield(a,<span class="string">'R1'</span>)
0095     r1=asin(a.R1(1,3));
0096 <span class="keyword">end</span>
0097 <span class="keyword">return</span></pre></div>
<hr>
<hr><address>GitHub Website <strong><a href="https://github.com/atcollab/at" target="_parent">at</a></strong> &copy; 2018</address>
<br />
<address>Generated on Sun 04-Mar-2018 00:43:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>