<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of atplotsyn</title>
  <meta name="keywords" content="atplotsyn">
  <meta name="description" content="ATPLOTSYN Helper function for ATPLOT">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>

<!-- ../menu.html atmat --><!-- menu.html atplot --><h1>atplotsyn
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>ATPLOTSYN Helper function for ATPLOT</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function pp = atplotsyn(ax,ring,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)"><pre class="comment">ATPLOTSYN Helper function for ATPLOT

PATCHES=ATPLOTSYN(AX,RING) Plots the magnetic elements found in RING</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)">
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../atmat/atphysics/findspos.html" class="code" title="function spos = findspos(line,refpts)">findspos</a>	FINDSPOS returns longitudinal positions of accelerator lattice elements.</li><li><a href="../../atmat/lattice/atgetfieldvalues.html" class="code" title="function values = atgetfieldvalues(ring,varargin)">atgetfieldvalues</a>	ATGETFIELDVALUES retrieves the field values AT cell array of elements</li><li><a href="../../atmat/lattice/atguessclass.html" class="code" title="function atclass = atguessclass(elem, varargin)">atguessclass</a>	ATGUESSCLASS Tries to determine the class of an element</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="atbaseplot.html" class="code" title="function curve = atbaseplot(varargin)">atbaseplot</a>	ATBASEPLOT Plots data generated by a user-supplied function</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/DeltaS/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/TILT/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/TILT/testerrRotCorrector.html" class="code" title="">testerrRotCorrector</a>	</li></ul>
</div>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)">
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [xpl,ypl]=setxpl(s,l,xmotif,ymotif)</a></li><li><a href="#_sub2" class="code">function varargout=eltype(elem)</a></li></ul>
</div>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function pp = atplotsyn(ax,ring,varargin)</a>
0002 <span class="comment">%ATPLOTSYN Helper function for ATPLOT</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%PATCHES=ATPLOTSYN(AX,RING) Plots the magnetic elements found in RING</span>
0005 
0006 options=struct(varargin{:});
0007 labs=false(size(ring(:)));
0008 <span class="keyword">if</span> isfield(options,<span class="string">'labels'</span>)
0009     <span class="keyword">if</span> islogical(options.labels)
0010         labs=options.labels(:);
0011     <span class="keyword">elseif</span> isnumeric(options.labels)
0012         labs(options.labels)=true;
0013     <span class="keyword">end</span>
0014 <span class="keyword">end</span>
0015 indx=false(size(ring(:)));
0016 <span class="keyword">if</span> isfield(options,<span class="string">'index'</span>)
0017     <span class="keyword">if</span> islogical(options.index)
0018         indx=options.index(:);
0019     <span class="keyword">elseif</span> isnumeric(options.index)
0020         indx(options.index)=true;
0021     <span class="keyword">end</span>
0022 <span class="keyword">end</span>
0023 xlim=get(ax,<span class="string">'XLim'</span>);
0024 slim=diff(xlim);
0025 tlim=diff(get(ax,<span class="string">'YLim'</span>));
0026 nlines=length(get(ax,<span class="string">'Children'</span>));
0027 <span class="comment">%axes(ax);  % Compatibility with old matlab versions</span>
0028 
0029 sl=<a href="../../atmat/atphysics/findspos.html" class="code" title="function spos = findspos(line,refpts)">findspos</a>(ring(:,1),1:size(ring,1)+1);
0030 ll=diff(sl);
0031 sok=(sl(2:end)&gt;xlim(1)) &amp; (sl(1:end-1)&lt;xlim(2));
0032 sl=sl(sok);
0033 ll=ll(sok);
0034 rok=ring(sok);
0035 labs=labs(sok);
0036 indx=indx(sok);
0037 [dipoles,qpoles,spoles,mpoles,bpms]=cellfun(@<a href="#_sub2" class="code" title="subfunction varargout=eltype(elem)">eltype</a>,rok);
0038 
0039 ampl=0.05*tlim;     <span class="comment">% Dipoles</span>
0040 [xplot,yplot]=<a href="#_sub1" class="code" title="subfunction [xpl,ypl]=setxpl(s,l,xmotif,ymotif)">setxpl</a>(sl(dipoles),ll(dipoles),[0;0;1;1;0],ampl*[0;1;1;0;0]);
0041 <span class="comment">%[xplot,yplot]=setxpl(sl(dipoles),ll(dipoles),[0;0;1;1;0],ampl*[-1;1;1;-1;-1]);</span>
0042 p1=patch(xplot,yplot,[0.5 0.5 1],<span class="string">'DisplayName'</span>,<span class="string">'Dipoles'</span>);
0043 <span class="comment">%p1=patch(ax,xplot,yplot,[0.5 0.5 1],'DisplayName','Dipoles');</span>
0044 
0045 ampl=0.05*tlim;     <span class="comment">% Quadrupoles</span>
0046 foc=reshape(0.4*ampl*sign(<a href="../../atmat/lattice/atgetfieldvalues.html" class="code" title="function values = atgetfieldvalues(ring,varargin)">atgetfieldvalues</a>(rok(qpoles),<span class="string">'PolynomB'</span>,{2})),1,[]);
0047 [xplot,yplot]=<a href="#_sub1" class="code" title="subfunction [xpl,ypl]=setxpl(s,l,xmotif,ymotif)">setxpl</a>(sl(qpoles),ll(qpoles),[0;0;0.5;1;1;0],ampl*[0;1;1;1;0;0]);
0048 yplot(3,:)=yplot(3,:)+foc;
0049 <span class="comment">%[xplot,yplot]=setxpl(sl(qpoles),ll(qpoles),[0;0;0.5;1;1;0.5;0],ampl*[-1;1;1;1;-1;-1;-1]);</span>
0050 <span class="comment">%yplot(6,:)=yplot(6,:)-foc;</span>
0051 p2=patch(xplot,yplot,[1 0.5 0.5],<span class="string">'DisplayName'</span>,<span class="string">'Quadrupoles'</span>);
0052 <span class="comment">%p2=patch(ax,xplot,yplot,[1 0.5 0.5],'DisplayName','Quadrupoles');</span>
0053 
0054 ampl=0.04*tlim;     <span class="comment">% Sextupoles</span>
0055 foc=reshape(0.25*ampl*sign(<a href="../../atmat/lattice/atgetfieldvalues.html" class="code" title="function values = atgetfieldvalues(ring,varargin)">atgetfieldvalues</a>(rok(spoles),<span class="string">'PolynomB'</span>,{3})),1,[]);
0056 [xplot,yplot]=<a href="#_sub1" class="code" title="subfunction [xpl,ypl]=setxpl(s,l,xmotif,ymotif)">setxpl</a>(sl(spoles),ll(spoles),[0;0;0.33;0.66;1;1;0],ampl*[0;1;1;1;1;0;0]);
0057 yplot(3:4,:)=yplot(3:4,:)+foc([1;1],:);
0058 <span class="comment">%[xplot,yplot]=setxpl(sl(spoles),ll(spoles),[0;0;0.33;0.66;1;1;0.66;0.33;0],ampl*[-1;1;1;1;1;-1;-1;-1;-1]);</span>
0059 <span class="comment">%yplot(7:8,:)=yplot(7:8,:)-foc([1;1],:);</span>
0060 p3=patch(xplot,yplot,[0.5 1 0.5],<span class="string">'DisplayName'</span>,<span class="string">'Sextupoles'</span>);
0061 <span class="comment">%p3=patch(ax,xplot,yplot,[0.5 1 0.5],'DisplayName','Sextupoles');</span>
0062 
0063 ampl=0.03*tlim;     <span class="comment">% Other multipoles</span>
0064 [xplot,yplot]=<a href="#_sub1" class="code" title="subfunction [xpl,ypl]=setxpl(s,l,xmotif,ymotif)">setxpl</a>(sl(mpoles),ll(mpoles),[0;0;1;1;0],ampl*[0;1;1;0;0]);
0065 <span class="comment">%[xplot,yplot]=setxpl(sl(mpoles),ll(mpoles),[0;0;1;1;0],ampl*[-1;1;1;-1;-1]);</span>
0066 p4=patch(xplot,yplot,[0 0.5 0]);
0067 <span class="comment">%p4=patch(ax,xplot,yplot,[0 0.5 0]);</span>
0068 
0069 ampl=0.015*tlim;    <span class="comment">% BPMs</span>
0070 amplx=0.005*slim;
0071 [xplot,yplot]=<a href="#_sub1" class="code" title="subfunction [xpl,ypl]=setxpl(s,l,xmotif,ymotif)">setxpl</a>(sl(bpms),ones(1,sum(bpms)),[-amplx;0;amplx;0;-amplx],[0;-ampl;0;ampl;0]);
0072 p5=patch(xplot,yplot,[0 0 0],<span class="string">'DisplayName'</span>,<span class="string">'BPM'</span>);
0073 <span class="comment">%p5=patch(ax,xplot,yplot,[0 0 0],'clipping','off');</span>
0074 
0075 <span class="keyword">if</span> any(labs)
0076     slabs=sl(labs)+0.5*ll(labs);
0077     vlabs=cellfun(@(el) el.FamName,rok(labs),<span class="string">'UniformOutput'</span>,false);
0078     args={<span class="string">'Label'</span>,text(slabs,-0.03*tlim*ones(size(slabs)),vlabs,<span class="string">'Rotation'</span>,90,<span class="keyword">...</span>
0079         <span class="string">'Interpreter'</span>,<span class="string">'none'</span>,<span class="string">'FontUnits'</span>,<span class="string">'normalized'</span>,<span class="string">'FontSize'</span>,0.025,<span class="keyword">...</span>
0080         <span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)};
0081 <span class="keyword">else</span>
0082     args={};
0083 <span class="keyword">end</span>
0084 <span class="keyword">if</span> any(indx)
0085     sindex=sl(indx)+0.5*ll(indx);
0086     iiok=1:length(rok);
0087     vlabs=cellfun(@(el) el,num2cell(iiok(indx)),<span class="string">'UniformOutput'</span>,false);
0088     args={<span class="string">'Label'</span>,text(sindex,-0.05*tlim*ones(size(sindex)),vlabs,<span class="string">'Rotation'</span>,90,<span class="keyword">...</span>
0089         <span class="string">'Interpreter'</span>,<span class="string">'none'</span>,<span class="string">'FontUnits'</span>,<span class="string">'normalized'</span>,<span class="string">'FontSize'</span>,0.02,<span class="keyword">...</span>
0090         <span class="string">'HorizontalAlignment'</span>,<span class="string">'right'</span>)};
0091 <span class="keyword">else</span>
0092     args={};
0093 <span class="keyword">end</span>
0094 
0095 <span class="comment">% Put patches in the background</span>
0096 set(ax,<span class="string">'Children'</span>,circshift(get(ax,<span class="string">'Children'</span>),nlines));
0097 
0098 pp=struct(<span class="string">'Dipole'</span>,p1,<span class="string">'Quadrupole'</span>,p2,<span class="string">'Sextupole'</span>,p3,<span class="string">'Multipole'</span>,p4,<span class="keyword">...</span>
0099     <span class="string">'BPM'</span>,p5,args{:});
0100 
0101     <a name="_sub1" href="#_subfunctions" class="code">function [xpl,ypl]=setxpl(s,l,xmotif,ymotif)</a>
0102         nm=length(xmotif);
0103         xpl=s(ones(nm,1),:)+l(ones(nm,1),:).*xmotif(:,ones(1,length(s)));
0104         ypl=ymotif(:,ones(1,length(s)));
0105     <span class="keyword">end</span>
0106 
0107     <a name="_sub2" href="#_subfunctions" class="code">function varargout=eltype(elem)</a>
0108         <span class="keyword">if</span> isfield(elem,<span class="string">'Class'</span>)
0109             cls=elem.Class;
0110         <span class="keyword">else</span>
0111             cls=<a href="../../atmat/lattice/atguessclass.html" class="code" title="function atclass = atguessclass(elem, varargin)">atguessclass</a>(elem);
0112         <span class="keyword">end</span>
0113         tst=strcmp(cls,{<span class="string">'Bend'</span>,<span class="string">'Quadrupole'</span>,<span class="string">'Sextupole'</span>,<span class="string">'Multipole'</span>,<span class="string">'Monitor'</span>});
0114         varargout=num2cell(tst);
0115     <span class="keyword">end</span>
0116 <span class="keyword">end</span></pre></div>
<hr>
<hr><address>GitHub Website <strong><a href="https://github.com/atcollab/at" target="_parent">at</a></strong> &copy; 2018</address>
<br />
<address>Generated on Sun 04-Mar-2018 00:43:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>