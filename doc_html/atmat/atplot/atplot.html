<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of atplot</title>
  <meta name="keywords" content="atplot">
  <meta name="description" content="ATPLOT Plots optical functions">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>

<!-- ../menu.html atmat --><!-- menu.html atplot --><h1>atplot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>ATPLOT Plots optical functions</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function curve = atplot(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)"><pre class="comment">ATPLOT Plots optical functions

ATPLOT                 Plots THERING in the current axes

ATPLOT(RING)           Plots the lattice specified by RING

ATPLOT(AX,RING)        Plots in the axes specified by AX

ATPLOT(AX,RING,DPP)    Plots at momentum deviation DPP

ATPLOT(...,[SMIN SMAX])  Zoom on the specified range

ATPLOT(...,'OptionName',OptionValue,...) Available options:
   'inputtwiss',structure of optics   transferline optics 
               (ex: [optics_struct,~,~]=atlinopt(ring,0,1);
              atplot(ring,[0 10],@plBeamSize,'inputtwiss',optics_struct);)
   'comment',true|false        Prints lattice information (default:true)
   'synopt',true|false         Plots the lattice elements
   'labels',REFPTS             Display the names of selected element names
   'index',REFPTS             Display the index of selected element names
   'leftargs',{properties}     properties set on the left axis
   'rightargs',{properties}    properties set on the right axis
   'KeepAxis'                  flag to keep R1,R2,T1,T2 at each slice in
                               detailed plots (mandatory with vert. bend).

ATPLOT(...,@PLOTFUNCTION,args...)
    Allows for a user supplied function providing the values to be plotted
   PLOTFUNCTION must be of form:
   PLOTDATA=PLOTFUNCTION(LINDATA,RING,DPP,args...)

       PLOTDATA: structure array,
         PLOTDATA(1) describes data for the left (main) axis
           PLOTDATA(1).VALUES: data to be plotted, length(ring)+1 x nbcurve
           PLOTDATA(1).LABELS: curve labels, cell array, 1 x nbcurve
           PLOTDATA(1).AXISLABEL: string
         PLOTDATA(2) optional, describes data for the right (secondary) axis

   The default function displayed below as an example plots beta functions
    and dispersion

 function plotdata=defaultplot(lindata,ring,dpp,varargin)
 beta=cat(1,lindata.beta);                     % left axis
 plotdata(1).values=beta;
 plotdata(1).labels={'\beta_x','\beta_z'};
 plotdata(1).axislabel='\beta [m]';
 dispersion=cat(2,lindata.Dispersion)';        % right axis
 plotdata(2).values=dispersion(:,1);
 plotdata(2).labels={'\eta_x'};
 plotdata(2).axislabel='dispersion [m]';
 end

CURVE=ATPLOT(...) Returns handles to some objects:
   CURVE.PERIODICIY ring periodicity
   CURVE.LENGTH    structure length
   CURVE.DPP       deltap/p
   CURVE.LEFT      Handles to the left axis plots
   CURVE.RIGHT     Handles to the right axis plots
   CURVE.LATTICE   Handles to the Element patches: structure with fields
          Dipole,Quadrupole,Sextupole,Multipole,BPM,Label
   CURVE.COMMENT   Handles to the Comment text


ATPLOT calls the more general ATBASEPLOT function, which uses a slightly
different syntax.

See also: <a href="atbaseplot.html" class="code" title="function curve = atbaseplot(varargin)">atbaseplot</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)">
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../atmat/atphysics/ParameterSummaryFunctions/atlinopt.html" class="code" title="function [lindata, varargout] = atlinopt(RING,DP,varargin)">atlinopt</a>	ATLINOPT Performs linear analysis of the COUPLED lattices</li><li><a href="../../atmat/atphysics/ParameterSummaryFunctions/twissline.html" class="code" title="function [TD, varargout] = twissline(LINE,DP,TWISSDATAIN,varargin)">twissline</a>	TWISSLINE calculates linear optics functions for an UNCOUPLED transport line</li><li><a href="atbaseplot.html" class="code" title="function curve = atbaseplot(varargin)">atbaseplot</a>	ATBASEPLOT Plots data generated by a user-supplied function</li><li><a href="../../atmat/lattice/getoption.html" class="code" title="function [optval,opts] = getoption(opts,optname,defval)">getoption</a>	GETOPTION Extract a keyword argument from the input arguments</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../atmat/atdemos/atmatchExamples/ExampleATMATCH/runtotest_atmatch.html" class="code" title="">runtotest_atmatch</a>	macro match dba test lattice beta functions and dispersion using</li><li><a href="../../atmat/atdemos/atmatchExamples/bump/run_BumpFit.html" class="code" title="">run_BumpFit</a>	fit a bump using correctors</li><li><a href="../../atmat/atdiag.html" class="code" title="function atdiag">atdiag</a>	ATDIAG Tests AT intallation</li><li><a href="../../atmat/lattice/Converters/ELEGANT2AT/ele2at_run_me.html" class="code" title="">ele2at_run_me</a>	test_elegant_converter</li><li><a href="../../atmat/lattice/Converters/MADX2AT/Examples/convertMADXtoATExample.html" class="code" title="">convertMADXtoATExample</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/correction/orbitbumps/matching/testorbitbump.html" class="code" title="">testorbitbump</a>	test matching orbit bump</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/BPMerrors/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/DXDY/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/DeltaS/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/FieldIntegral/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/Girders/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/LargeErrList/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/LargeWaveList/testcor.html" class="code" title="">testcor</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/Survey/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/TILT/testerr.html" class="code" title="">testerr</a>	</li><li><a href="../../atmat/pubtools/LatticeTuningFunctions/errors/TILT/testerrRotCorrector.html" class="code" title="">testerrRotCorrector</a>	</li></ul>
</div>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)">
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [s,plotdata]=ringplot(ring,dpp,plotfun,varargin)</a></li><li><a href="#_sub2" class="code">function [s,plotdata]=lineplot(ring,dpp,inputtwiss,plotfun,varargin)</a></li><li><a href="#_sub3" class="code">function plotdata=defaultplot(lindata,ring,dpp,varargin)</a></li></ul>
</div>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function curve = atplot(varargin)</a>
0002 <span class="comment">%ATPLOT Plots optical functions</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%ATPLOT                 Plots THERING in the current axes</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%ATPLOT(RING)           Plots the lattice specified by RING</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%ATPLOT(AX,RING)        Plots in the axes specified by AX</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%ATPLOT(AX,RING,DPP)    Plots at momentum deviation DPP</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%ATPLOT(...,[SMIN SMAX])  Zoom on the specified range</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%ATPLOT(...,'OptionName',OptionValue,...) Available options:</span>
0015 <span class="comment">%   'inputtwiss',structure of optics   transferline optics</span>
0016 <span class="comment">%               (ex: [optics_struct,~,~]=atlinopt(ring,0,1);</span>
0017 <span class="comment">%              atplot(ring,[0 10],@plBeamSize,'inputtwiss',optics_struct);)</span>
0018 <span class="comment">%   'comment',true|false        Prints lattice information (default:true)</span>
0019 <span class="comment">%   'synopt',true|false         Plots the lattice elements</span>
0020 <span class="comment">%   'labels',REFPTS             Display the names of selected element names</span>
0021 <span class="comment">%   'index',REFPTS             Display the index of selected element names</span>
0022 <span class="comment">%   'leftargs',{properties}     properties set on the left axis</span>
0023 <span class="comment">%   'rightargs',{properties}    properties set on the right axis</span>
0024 <span class="comment">%   'KeepAxis'                  flag to keep R1,R2,T1,T2 at each slice in</span>
0025 <span class="comment">%                               detailed plots (mandatory with vert. bend).</span>
0026 <span class="comment">%</span>
0027 <span class="comment">%ATPLOT(...,@PLOTFUNCTION,args...)</span>
0028 <span class="comment">%    Allows for a user supplied function providing the values to be plotted</span>
0029 <span class="comment">%   PLOTFUNCTION must be of form:</span>
0030 <span class="comment">%   PLOTDATA=PLOTFUNCTION(LINDATA,RING,DPP,args...)</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%       PLOTDATA: structure array,</span>
0033 <span class="comment">%         PLOTDATA(1) describes data for the left (main) axis</span>
0034 <span class="comment">%           PLOTDATA(1).VALUES: data to be plotted, length(ring)+1 x nbcurve</span>
0035 <span class="comment">%           PLOTDATA(1).LABELS: curve labels, cell array, 1 x nbcurve</span>
0036 <span class="comment">%           PLOTDATA(1).AXISLABEL: string</span>
0037 <span class="comment">%         PLOTDATA(2) optional, describes data for the right (secondary) axis</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   The default function displayed below as an example plots beta functions</span>
0040 <span class="comment">%    and dispersion</span>
0041 <span class="comment">%</span>
0042 <span class="comment">% function plotdata=defaultplot(lindata,ring,dpp,varargin)</span>
0043 <span class="comment">% beta=cat(1,lindata.beta);                     % left axis</span>
0044 <span class="comment">% plotdata(1).values=beta;</span>
0045 <span class="comment">% plotdata(1).labels={'\beta_x','\beta_z'};</span>
0046 <span class="comment">% plotdata(1).axislabel='\beta [m]';</span>
0047 <span class="comment">% dispersion=cat(2,lindata.Dispersion)';        % right axis</span>
0048 <span class="comment">% plotdata(2).values=dispersion(:,1);</span>
0049 <span class="comment">% plotdata(2).labels={'\eta_x'};</span>
0050 <span class="comment">% plotdata(2).axislabel='dispersion [m]';</span>
0051 <span class="comment">% end</span>
0052 <span class="comment">%</span>
0053 <span class="comment">%CURVE=ATPLOT(...) Returns handles to some objects:</span>
0054 <span class="comment">%   CURVE.PERIODICIY ring periodicity</span>
0055 <span class="comment">%   CURVE.LENGTH    structure length</span>
0056 <span class="comment">%   CURVE.DPP       deltap/p</span>
0057 <span class="comment">%   CURVE.LEFT      Handles to the left axis plots</span>
0058 <span class="comment">%   CURVE.RIGHT     Handles to the right axis plots</span>
0059 <span class="comment">%   CURVE.LATTICE   Handles to the Element patches: structure with fields</span>
0060 <span class="comment">%          Dipole,Quadrupole,Sextupole,Multipole,BPM,Label</span>
0061 <span class="comment">%   CURVE.COMMENT   Handles to the Comment text</span>
0062 <span class="comment">%</span>
0063 <span class="comment">%</span>
0064 <span class="comment">%ATPLOT calls the more general ATBASEPLOT function, which uses a slightly</span>
0065 <span class="comment">%different syntax.</span>
0066 <span class="comment">%</span>
0067 <span class="comment">%See also: atbaseplot</span>
0068 
0069 funcarg=find(cellfun(@(arg) isa(arg,<span class="string">'function_handle'</span>),varargin),1);
0070 <span class="keyword">if</span> isempty(funcarg)
0071     funcarg=nargin+1;
0072 <span class="keyword">end</span>
0073 resarg=find(cellfun(@(arg) ischar(arg),varargin(1:funcarg-1)),1);
0074 <span class="keyword">if</span> isempty(resarg)
0075     resarg=funcarg;
0076 <span class="keyword">end</span>
0077 options=varargin(resarg:funcarg-1);
0078 [comment,options]=<a href="../../atmat/lattice/getoption.html" class="code" title="function [optval,opts] = getoption(opts,optname,defval)">getoption</a>(options,<span class="string">'comment'</span>,true);
0079 [intwi,options]=<a href="../../atmat/lattice/getoption.html" class="code" title="function [optval,opts] = getoption(opts,optname,defval)">getoption</a>(options,<span class="string">'inputtwiss'</span>,[]);
0080 <span class="comment">%openline=find(strcmp(options(cellfun(@ischar,options)),'inputtwiss'));</span>
0081 
0082 lindata=[];
0083 
0084 <span class="keyword">if</span> isempty(intwi)    <span class="comment">% closed ring, DEFAULT</span>
0085     curve=<a href="atbaseplot.html" class="code" title="function curve = atbaseplot(varargin)">atbaseplot</a>(varargin{1:resarg-1},<span class="keyword">...</span>
0086         @<a href="#_sub1" class="code" title="subfunction [s,plotdata]=ringplot(ring,dpp,plotfun,varargin)">ringplot</a>,varargin(funcarg:end),options{:});
0087 <span class="keyword">else</span>                <span class="comment">% openline plot</span>
0088     curve=<a href="atbaseplot.html" class="code" title="function curve = atbaseplot(varargin)">atbaseplot</a>(varargin{1:resarg-1},<span class="keyword">...</span>
0089         @<a href="#_sub2" class="code" title="subfunction [s,plotdata]=lineplot(ring,dpp,inputtwiss,plotfun,varargin)">lineplot</a>,[{intwi} varargin(funcarg:end)],options{:});
0090 <span class="keyword">end</span>
0091 
0092 <span class="keyword">if</span> (comment)
0093     ax=get(curve.left(1),<span class="string">'Parent'</span>);
0094     set(ax,<span class="string">'Position'</span>,[.13 .11 .775 .775]);
0095     tuneper=lindata(end).mu/2/pi;
0096     tunes=curve.periodicity*tuneper;
0097     circumference=curve.periodicity*curve.length;
0098     <span class="keyword">if</span> curve.periodicity &gt; 1, plural=<span class="string">'s'</span>; <span class="keyword">else</span> plural=<span class="string">''</span>; <span class="keyword">end</span>
0099     line1=sprintf(<span class="string">'\\nu_x=%8.3f      \\deltap/p=%.3f%i %s'</span>,tunes(1),curve.dpp);
0100     line2=sprintf(<span class="string">'\\nu_z=%8.3f      %2i %s, C=%10.3f'</span>,tunes(2),<span class="keyword">...</span>
0101         curve.periodicity,[<span class="string">'period'</span> plural],circumference);
0102     curve.comment=text(ax,-0.14,1.12,{line1;line2},<span class="string">'Units'</span>,<span class="string">'normalized'</span>,<span class="keyword">...</span>
0103         <span class="string">'VerticalAlignment'</span>,<span class="string">'top'</span>);
0104 <span class="keyword">end</span>
0105 
0106     <span class="comment">% RING</span>
0107     <a name="_sub1" href="#_subfunctions" class="code">function [s,plotdata]=ringplot(ring,dpp,plotfun,varargin)</a>
0108         [lindata,tune,chrom]=<a href="../../atmat/atphysics/ParameterSummaryFunctions/atlinopt.html" class="code" title="function [lindata, varargout] = atlinopt(RING,DP,varargin)">atlinopt</a>(ring,dpp,1:length(ring)+1); <span class="comment">%#ok&lt;ASGLU&gt;</span>
0109         s=cat(1,lindata.SPos);
0110         <span class="keyword">if</span> nargin &lt; 3
0111             plotdata=<a href="#_sub3" class="code" title="subfunction plotdata=defaultplot(lindata,ring,dpp,varargin) ">defaultplot</a>(lindata,ring,dpp);
0112         <span class="keyword">else</span>
0113             plotdata=plotfun(lindata,ring,dpp,varargin{:});
0114         <span class="keyword">end</span>
0115     <span class="keyword">end</span>
0116 
0117     <span class="comment">% OPEN LINE</span>
0118     <a name="_sub2" href="#_subfunctions" class="code">function [s,plotdata]=lineplot(ring,dpp,inputtwiss,plotfun,varargin)</a>
0119         lindata=<a href="../../atmat/atphysics/ParameterSummaryFunctions/twissline.html" class="code" title="function [TD, varargout] = twissline(LINE,DP,TWISSDATAIN,varargin)">twissline</a>(ring,dpp,inputtwiss,1:length(ring)+1,<span class="string">'chrom'</span>); 
0120         s=cat(1,lindata.SPos);
0121         <span class="keyword">if</span> nargin &lt; 4
0122             plotdata=<a href="#_sub3" class="code" title="subfunction plotdata=defaultplot(lindata,ring,dpp,varargin) ">defaultplot</a>(lindata,ring,dpp);
0123         <span class="keyword">else</span>
0124             plotdata=plotfun(lindata,ring,dpp,varargin{:});
0125         <span class="keyword">end</span>
0126     <span class="keyword">end</span>
0127 
0128 
0129 <span class="keyword">end</span>
0130 
0131 <a name="_sub3" href="#_subfunctions" class="code">function plotdata=defaultplot(lindata,ring,dpp,varargin) </a><span class="comment">%#ok&lt;INUSD&gt;</span>
0132 <span class="comment">%DEFAULTPLOT    Default plotting function for ATPLOT</span>
0133 <span class="comment">%</span>
0134 <span class="comment">%Plots beta-functions on left axis and dispersion on right axis</span>
0135 
0136 beta=cat(1,lindata.beta);
0137 plotdata(1).values=beta;
0138 plotdata(1).labels={<span class="string">'\beta_x'</span>,<span class="string">'\beta_z'</span>};
0139 plotdata(1).axislabel=<span class="string">'\beta [m]'</span>;
0140 dispersion=cat(2,lindata.Dispersion)';
0141 plotdata(2).values=dispersion(:,1);
0142 plotdata(2).labels={<span class="string">'\eta_x'</span>};
0143 plotdata(2).axislabel=<span class="string">'dispersion [m]'</span>;
0144 <span class="keyword">end</span></pre></div>
<hr>
<hr><address>GitHub Website <strong><a href="https://github.com/atcollab/at" target="_parent">at</a></strong> &copy; 2018</address>
<br />
<address>Generated on Sun 04-Mar-2018 00:43:10 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>