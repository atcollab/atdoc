<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of atbaseplot</title>
  <meta name="keywords" content="atbaseplot">
  <meta name="description" content="ATBASEPLOT Plots data generated by a user-supplied function">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html atmat --><!-- menu.html atplot --><h1>atbaseplot
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>ATBASEPLOT Plots data generated by a user-supplied function</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function curve = atbaseplot(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)"><pre class="comment">ATBASEPLOT Plots data generated by a user-supplied function

ATBASEPLOT             Plots THERING in the current axes

ATBASEPLOT(RING)       Plots the lattice specified by RING

ATBASEPLOT(RING,DPP)   Plots at momentum deviation DPP (default: 0)

ATBASEPLOT(...,[SMIN SMAX])  Zoom on the specified range

ATBASEPLOT(...,@PLOTFUNCTION,PLOTARGS)
   PLOTFUNCTION: User supplied function providing the values to be plotted
   PLOTARGS:     Optional cell array of arguments to PLOTFUNCTION
   PLOTFUNCTION is called as: 
   [S,PLOTDATA]=PLOTFUNCTION(RING,DPP,PLOTARGS{:})

       S:        longitudinal position, length(ring)+1 x 1
       PLOTDATA: structure array,
         PLOTDATA(1) describes data for the left (main) axis
           PLOTDATA(1).VALUES: data to be plotted, length(ring)+1 x nbcurve
           PLOTDATA(1).LABELS: curve labels, cell array, 1 x nbcurve
           PLOTDATA(1).AXISLABEL: string
         PLOTDATA(2) optional, describes data for the right (secondary) axis

ATBASEPLOT(...,'OptionName',OptionValue,...) Available options:
   'synopt',true|false         Plots the lattice elements
   'labels',REFPTS             Display the names of selected element names
   'index',REFPTS             Display the index of selected element names
   'leftargs',{properties}     properties set on the left axis
   'rightargs',{properties}    properties set on the right axis
   'KeepAxis'                  flag to keep R1,R2,T1,T2 at each slice in
                               detailed plots (mandatory with vert. bend).

ATBASEPLOT(AX,...)     Plots in the axes specified by AX. AX can precede
                       any previous argument combination

CURVE=ATBASEPLOT(...)  Returns handles to some objects:
   CURVE.PERIODICIY ring periodicity
   CURVE.LENGTH    structure length
   CURVE.DPP       deltap/p
   CURVE.LEFT      Handles to the left axis plots
   CURVE.RIGHT     Handles to the right axis plots
   CURVE.LATTICE   Handles to the Element patches: structure with fields
          Dipole,Quadrupole,Sextupole,Multipole,BPM,Label</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)">
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../atmat/atphysics/findspos.html" class="code" title="function spos = findspos(line,refpts)">findspos</a>	FINDSPOS returns longitudinal positions of accelerator lattice elements.</li><li><a href="atplotsyn.html" class="code" title="function pp = atplotsyn(ax,ring,varargin)">atplotsyn</a>	ATPLOTSYN Helper function for ATPLOT</li><li><a href="../../atmat/lattice/atdivelem.html" class="code" title="function line = atdivelem(elem,frac,varargin)">atdivelem</a>	LINE=ATDIVELEM(ELEM,FRAC) divide an element into pieces</li><li><a href="../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>	ATGETCELLS performs a search on MATLAB cell arrays of structures</li><li><a href="../../atmat/lattice/getflag.html" class="code" title="function [flag,opts] = getflag(opts,optname)">getflag</a>	GETFLAG Check the presence of a flag in an argument list</li><li><a href="../../atmat/lattice/getoption.html" class="code" title="function [optval,opts] = getoption(opts,optname,defval)">getoption</a>	GETOPTION Extract a keyword argument from the input arguments</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="atplot.html" class="code" title="function curve = atplot(varargin)">atplot</a>	ATPLOT Plots optical functions</li></ul>
</div>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)">
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function newelems=splitelem(elem)</a></li><li><a href="#_sub2" class="code">function [cellsize,np,cell]=get1cell(ring)</a></li><li><a href="#_sub3" class="code">function [s,plotdata]=defaultplot(ring,dpp,varargin)</a></li></ul>
</div>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment" style="background-image:url(../../atcollab.png)"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function curve = atbaseplot(varargin)</a>
0002 <span class="comment">%ATBASEPLOT Plots data generated by a user-supplied function</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%ATBASEPLOT             Plots THERING in the current axes</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%ATBASEPLOT(RING)       Plots the lattice specified by RING</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%ATBASEPLOT(RING,DPP)   Plots at momentum deviation DPP (default: 0)</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%ATBASEPLOT(...,[SMIN SMAX])  Zoom on the specified range</span>
0011 <span class="comment">%</span>
0012 <span class="comment">%ATBASEPLOT(...,@PLOTFUNCTION,PLOTARGS)</span>
0013 <span class="comment">%   PLOTFUNCTION: User supplied function providing the values to be plotted</span>
0014 <span class="comment">%   PLOTARGS:     Optional cell array of arguments to PLOTFUNCTION</span>
0015 <span class="comment">%   PLOTFUNCTION is called as:</span>
0016 <span class="comment">%   [S,PLOTDATA]=PLOTFUNCTION(RING,DPP,PLOTARGS{:})</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%       S:        longitudinal position, length(ring)+1 x 1</span>
0019 <span class="comment">%       PLOTDATA: structure array,</span>
0020 <span class="comment">%         PLOTDATA(1) describes data for the left (main) axis</span>
0021 <span class="comment">%           PLOTDATA(1).VALUES: data to be plotted, length(ring)+1 x nbcurve</span>
0022 <span class="comment">%           PLOTDATA(1).LABELS: curve labels, cell array, 1 x nbcurve</span>
0023 <span class="comment">%           PLOTDATA(1).AXISLABEL: string</span>
0024 <span class="comment">%         PLOTDATA(2) optional, describes data for the right (secondary) axis</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%ATBASEPLOT(...,'OptionName',OptionValue,...) Available options:</span>
0027 <span class="comment">%   'synopt',true|false         Plots the lattice elements</span>
0028 <span class="comment">%   'labels',REFPTS             Display the names of selected element names</span>
0029 <span class="comment">%   'index',REFPTS             Display the index of selected element names</span>
0030 <span class="comment">%   'leftargs',{properties}     properties set on the left axis</span>
0031 <span class="comment">%   'rightargs',{properties}    properties set on the right axis</span>
0032 <span class="comment">%   'KeepAxis'                  flag to keep R1,R2,T1,T2 at each slice in</span>
0033 <span class="comment">%                               detailed plots (mandatory with vert. bend).</span>
0034 <span class="comment">%</span>
0035 <span class="comment">%ATBASEPLOT(AX,...)     Plots in the axes specified by AX. AX can precede</span>
0036 <span class="comment">%                       any previous argument combination</span>
0037 <span class="comment">%</span>
0038 <span class="comment">%CURVE=ATBASEPLOT(...)  Returns handles to some objects:</span>
0039 <span class="comment">%   CURVE.PERIODICIY ring periodicity</span>
0040 <span class="comment">%   CURVE.LENGTH    structure length</span>
0041 <span class="comment">%   CURVE.DPP       deltap/p</span>
0042 <span class="comment">%   CURVE.LEFT      Handles to the left axis plots</span>
0043 <span class="comment">%   CURVE.RIGHT     Handles to the right axis plots</span>
0044 <span class="comment">%   CURVE.LATTICE   Handles to the Element patches: structure with fields</span>
0045 <span class="comment">%          Dipole,Quadrupole,Sextupole,Multipole,BPM,Label</span>
0046 <span class="comment">%</span>
0047 
0048 <span class="keyword">global</span> THERING
0049 
0050 npts=400; <span class="comment">% number of point</span>
0051 narg=1;
0052 <span class="comment">% Select axes for the plot</span>
0053 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; isscalar(varargin{narg}) &amp;&amp; ishandle(varargin{narg})
0054     ax=varargin{narg};
0055     narg=narg+1;
0056 <span class="keyword">else</span>
0057     ax=gca;
0058 <span class="keyword">end</span>
0059 <span class="comment">% Select the lattice</span>
0060 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; iscell(varargin{narg})
0061     [elt0,curve.periodicity,ring0]=<a href="#_sub2" class="code" title="subfunction [cellsize,np,cell]=get1cell(ring)">get1cell</a>(varargin{narg});
0062     narg=narg+1;
0063 <span class="keyword">else</span>
0064     [elt0,curve.periodicity,ring0]=<a href="#_sub2" class="code" title="subfunction [cellsize,np,cell]=get1cell(ring)">get1cell</a>(THERING);
0065 <span class="keyword">end</span>
0066 s0=<a href="../../atmat/atphysics/findspos.html" class="code" title="function spos = findspos(line,refpts)">findspos</a>(ring0,1:elt0+1);
0067 curve.length=s0(end);
0068 <span class="comment">% Select the momentum deviation</span>
0069 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; isscalar(varargin{narg}) &amp;&amp; isnumeric(varargin{narg})
0070     curve.dpp=varargin{narg};
0071     narg=narg+1;
0072 <span class="keyword">else</span>
0073     curve.dpp=0;
0074 <span class="keyword">end</span>
0075 <span class="comment">% Select the plotting range</span>
0076 el1=1;
0077 el2=elt0+1;
0078 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; isnumeric(varargin{narg}) &amp;&amp; (numel(varargin{narg})==2)
0079     srange=varargin{narg};
0080     els=find(srange(1)&gt;s0,1,<span class="string">'last'</span>);
0081     <span class="keyword">if</span> ~isempty(els), el1=els; <span class="keyword">end</span>
0082     els=find(s0&gt;srange(2),1,<span class="string">'first'</span>);
0083     <span class="keyword">if</span> ~isempty(els), el2=els; <span class="keyword">end</span>
0084     narg=narg+1;
0085 <span class="keyword">else</span>
0086     srange=[0 curve.length];
0087 <span class="keyword">end</span>
0088 <span class="comment">% select the plotting function</span>
0089 plotargs={};
0090 <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; isa(varargin{narg},<span class="string">'function_handle'</span>)
0091     plotfun=varargin{narg};
0092     narg=narg+1;
0093     <span class="keyword">if</span> narg&lt;=length(varargin) &amp;&amp; iscell(varargin{narg})
0094         plotargs=varargin{narg};
0095         narg=narg+1;
0096     <span class="keyword">end</span>
0097 <span class="keyword">else</span>
0098     plotfun=@<a href="#_sub3" class="code" title="subfunction [s,plotdata]=defaultplot(ring,dpp,varargin) ">defaultplot</a>;
0099 <span class="keyword">end</span>
0100 <span class="comment">% Get options</span>
0101 rsrc=varargin(narg:end);
0102 [synopt,rsrc]=<a href="../../atmat/lattice/getoption.html" class="code" title="function [optval,opts] = getoption(opts,optname,defval)">getoption</a>(rsrc,<span class="string">'synopt'</span>,true);
0103 [leftargs,rsrc]=<a href="../../atmat/lattice/getoption.html" class="code" title="function [optval,opts] = getoption(opts,optname,defval)">getoption</a>(rsrc,<span class="string">'leftargs'</span>,{});
0104 [rightargs,rsrc]=<a href="../../atmat/lattice/getoption.html" class="code" title="function [optval,opts] = getoption(opts,optname,defval)">getoption</a>(rsrc,<span class="string">'rightargs'</span>,{});
0105 [KeepAxis,rsrc]=<a href="../../atmat/lattice/getflag.html" class="code" title="function [flag,opts] = getflag(opts,optname)">getflag</a>(rsrc,<span class="string">'KeepAxis'</span>);
0106 <span class="comment">% Split the ring</span>
0107 elmlength=<a href="../../atmat/atphysics/findspos.html" class="code" title="function spos = findspos(line,refpts)">findspos</a>(ring0(el1:el2-1),el2-el1+1)/npts;
0108 r2=cellfun(@<a href="#_sub1" class="code" title="subfunction newelems=splitelem(elem)">splitelem</a>,ring0(el1:el2-1),<span class="string">'UniformOutput'</span>,false);
0109 ring=cat(1,ring0(1:el1-1),r2{:},ring0(el2:elt0));
0110 plrange=el1:el2+length(ring)-elt0;
0111 
0112 [s,outp]=plotfun(ring,curve.dpp,plotargs{:});
0113 <span class="keyword">if</span> numel(outp) &gt;= 2
0114     [ax2,curve.left,curve.right]=plotyy(ax,<span class="keyword">...</span>
0115         s(plrange),outp(1).values(plrange,:),<span class="keyword">...</span>
0116         s(plrange),outp(2).values(plrange,:));
0117     set(ax2(2),<span class="string">'XTick'</span>,[],<span class="string">'YColor'</span>,get(ax2(1),<span class="string">'YColor'</span>),rightargs{:});
0118     ylabel(ax2(1),outp(1).axislabel);
0119     ylabel(ax2(2),outp(2).axislabel);
0120     linkaxes([ax2(1) ax2(2)],<span class="string">'x'</span>);<span class="comment">% allows zoom on both right and left plots</span>
0121 <span class="keyword">elseif</span> numel(outp) == 1
0122     curve.left=plot(ax,s(plrange),outp(1).values(plrange,:));
0123     curve.right=[];
0124     ylabel(ax,outp(1).axislabel);
0125 <span class="keyword">else</span>
0126     curve.left=[];
0127     curve.right=[];
0128     set(ax,<span class="string">'YLim'</span>,[0 1]);
0129 <span class="keyword">end</span>
0130 set(ax,<span class="string">'XLim'</span>,srange,<span class="string">'XGrid'</span>,<span class="string">'on'</span>,<span class="string">'YGrid'</span>,<span class="string">'on'</span>,leftargs{:});
0131 xlabel(ax,<span class="string">'s [m]'</span>);
0132 <span class="keyword">if</span> synopt
0133     curve.lattice=<a href="atplotsyn.html" class="code" title="function pp = atplotsyn(ax,ring,varargin)">atplotsyn</a>(ax,ring0,rsrc{:});  <span class="comment">% Plot lattice elements</span>
0134 <span class="keyword">end</span>
0135 lines=[curve.left;curve.right];
0136 <span class="keyword">if</span> ~isempty(lines)
0137     legend(lines,[outp.labels],<span class="string">'FontSize'</span>,11);
0138 <span class="keyword">end</span>
0139 
0140     <a name="_sub1" href="#_subfunctions" class="code">function newelems=splitelem(elem)</a>
0141         <span class="keyword">if</span> isfield(elem,<span class="string">'Length'</span>) &amp;&amp; elem.Length &gt; 0
0142             nslices=ceil(elem.Length/elmlength);
0143             <span class="keyword">if</span> ~KeepAxis
0144                 newelems=<a href="../../atmat/lattice/atdivelem.html" class="code" title="function line = atdivelem(elem,frac,varargin)">atdivelem</a>(elem,ones(1,nslices)./nslices);
0145             <span class="keyword">else</span>
0146                 newelems=<a href="../../atmat/lattice/atdivelem.html" class="code" title="function line = atdivelem(elem,frac,varargin)">atdivelem</a>(elem,ones(1,nslices)./nslices,<span class="string">'KeepAxis'</span>);
0147             <span class="keyword">end</span>
0148         <span class="keyword">else</span>
0149             newelems={elem};
0150         <span class="keyword">end</span>
0151     <span class="keyword">end</span>
0152 
0153     <a name="_sub2" href="#_subfunctions" class="code">function [cellsize,np,cell]=get1cell(ring)</a>
0154         [cellsize,np]=size(ring);
0155         cell=ring(:,1);
0156         params=<a href="../../atmat/lattice/atgetcells.html" class="code" title="function ok=atgetcells(cellarray, field, varargin)">atgetcells</a>(cell,<span class="string">'Class'</span>,<span class="string">'RingParam'</span>);
0157         <span class="keyword">if</span> any(params)
0158             np=ring{find(params,1)}.Periodicity;
0159         <span class="keyword">end</span>
0160     <span class="keyword">end</span>
0161 <span class="keyword">end</span>
0162 
0163 <a name="_sub3" href="#_subfunctions" class="code">function [s,plotdata]=defaultplot(ring,dpp,varargin) </a><span class="comment">%#ok&lt;INUSD&gt;</span>
0164 <span class="comment">%DEFAULTPLOT    Default plotting function for ATBASEPLOT</span>
0165 <span class="comment">%Plots nothing</span>
0166 
0167 s=[];
0168 plotdata=[];
0169 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sat 03-Mar-2018 19:26:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>